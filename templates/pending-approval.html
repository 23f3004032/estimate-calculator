<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pending Approval - Hospital Estimate Builder</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='hospital-style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="header-container">
            <div class="brand">
                <svg class="logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--hospital-blue);">
                    <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.29 1.51 4.04 3 5.5l7 7Z"/>
                    <path d="M12 5L8 21l4-7 4 7-4-16"/>
                </svg>
                <h1>Hospital Estimate Builder</h1>
            </div>
            <nav class="nav-links">
                <div class="flex items-center text-muted">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    <span id="user-name">{{ user.username }}</span>
                </div>
                <button class="btn btn-outline" onclick="logout()" style="margin-left: 1rem;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16,17 21,12 16,7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                    Logout
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container" style="max-width: 800px; margin: 0 auto; padding: 2rem 1rem;">
        <div class="card" style="text-align: center;">
            <div class="card-header">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--hospital-blue); margin: 0 auto 1rem;">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12,6 12,12 16,14"/>
                </svg>
                <h2 class="card-title">Account Pending Approval</h2>
            </div>
            
            {% if rejected %}
            <div style="margin-bottom: 2rem;">
                <p style="font-size: 1.125rem; color: var(--destructive); margin-bottom: 1rem;">
                    Your {{ user.role }} account registration has been rejected by the administrator.
                </p>
                <p style="color: var(--muted-foreground);">
                    Please contact the administrator for more information or create a new account with different credentials.
                </p>
            </div>

            <div class="alert alert-error" style="margin-bottom: 2rem;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="15" y1="9" x2="9" y2="15"/>
                        <line x1="9" y1="9" x2="15" y2="15"/>
                    </svg>
                    <strong>Status:</strong> Account rejected by administrator
                </div>
            </div>
            {% else %}
            <div style="margin-bottom: 2rem;">
                <p style="font-size: 1.125rem; color: var(--muted-foreground); margin-bottom: 1rem;">
                    Your {{ user.role }} account has been created successfully!
                </p>
                <p style="color: var(--muted-foreground);">
                    Please wait for an administrator to approve your account. You will be able to access the system once approved.
                </p>
            </div>

            <div class="alert" style="background-color: hsl(45, 85%, 97%); border-color: hsl(45, 85%, 60%); color: hsl(45, 85%, 30%); margin-bottom: 2rem;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/>
                    </svg>
                    <strong>Status:</strong> Waiting for admin approval
                </div>
            </div>
            {% endif %}

            <div style="display: flex; gap: 1rem; justify-content: center;">
                {% if rejected %}
                <a href="/signup" class="btn btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="8.5" cy="7" r="4"/>
                        <line x1="20" y1="8" x2="20" y2="14"/>
                        <line x1="23" y1="11" x2="17" y2="11"/>
                    </svg>
                    Create New Account
                </a>
                {% else %}
                <button class="btn btn-primary" onclick="checkApprovalStatus()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12c0 1-1 2-2 2s-2-1-2-2 1-2 2-2 2 1 2 2z"/>
                        <path d="M3 12c0 1 1 2 2 2s2-1 2-2-1-2-2-2-2 1-2 2z"/>
                        <path d="M12 21c1 0 2-1 2-2s-1-2-2-2-2 1-2 2 1 2 2 2z"/>
                        <path d="M12 3c1 0 2 1 2 2s-1 2-2 2-2-1-2-2 1-2 2-2z"/>
                    </svg>
                    Check Status
                </button>
                {% endif %}
                <button class="btn btn-outline" onclick="logout()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16,17 21,12 16,7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                    Logout
                </button>
            </div>
        </div>
    </div>

    <script>
        // Check approval status
        async function checkApprovalStatus() {
            try {
                const response = await fetch('/api/user-info');
                if (response.ok) {
                    const userData = await response.json();
                    if (userData.approved) {
                        showMessage('Account approved! Redirecting...', 'success');
                        setTimeout(() => {
                            window.location.href = '/dashboard';
                        }, 1500);
                    } else {
                        showMessage('Still waiting for approval', 'info');
                    }
                } else {
                    showMessage('Error checking status', 'error');
                }
            } catch (error) {
                console.error('Status check error:', error);
                showMessage('Network error', 'error');
            }
        }

        // Logout function
        async function logout() {
            try {
                const response = await fetch('/api/logout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    showMessage('Logged out successfully!', 'success');
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 1000);
                } else {
                    showMessage('Error logging out', 'error');
                }
            } catch (error) {
                console.error('Logout error:', error);
                showMessage('Network error during logout', 'error');
            }
        }

        // Show messages
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `alert alert-${type}`;
            messageDiv.textContent = message;
            messageDiv.style.position = 'fixed';
            messageDiv.style.top = '20px';
            messageDiv.style.right = '20px';
            messageDiv.style.zIndex = '9999';
            messageDiv.style.minWidth = '300px';
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 3000);
        }

        // Auto-check status every 30 seconds (only if not rejected)
        {% if not rejected %}
        setInterval(checkApprovalStatus, 30000);
        {% endif %}
    </script>
</body>
</html>